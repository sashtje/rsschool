(()=>{"use strict";var t;!function(t){t.Btn="btn",t.MainBtn="btn btn_is_main-btn",t.EngineStartBtn="btn btn_style_engine btn-start",t.EngineStopBtn="btn btn_style_engine btn-stop",t.SelectBtn="btn btn-select",t.RemoveBtn="btn btn-remove"}(t||(t={}));const e=(t,e,i,n)=>{const a=document.createElement("button");return a.className=t,a.textContent=e,i&&a.addEventListener("click",i),a.disabled=n,a};var i;!function(t){t.IsHidden="server-notification_is_hidden",t.IsShown="server-notification_is_shown"}(i||(i={}));const n=new class{constructor(){this.closeServerNotification=()=>{this.elem.addEventListener("transitionend",this.hideServerNotification),this.elem.classList.remove(i.IsShown)},this.hideServerNotification=()=>{this.elem.classList.add(i.IsHidden)},this.elem=document.createElement("div"),this.elem.className=`server-notification ${i.IsHidden}`,this.elem.innerHTML=this.getInnerLayout(),this.elem.addEventListener("click",this.closeServerNotification)}getInnerLayout(){return'\n    <div class="server-notification__message">\n      <p>Нет связи с сервером.</p>\n      <p>Проверьте включен ли сервер и попробуйте повторить желаемое действие.</p>\n      <p>Чтобы закрыть это сообщение, нажмите в любом месте экрана.</p>\n    </div>'}showServerNotification(){this.elem.classList.remove(i.IsHidden),this.elem.classList.add(i.IsShown)}};class a{constructor(t){this.handleClickStart=()=>{const t=new Event("init-garage-page",{bubbles:!0});this.btnStart.dispatchEvent(t)},this.rootElem=t}showPage(){this.btnStart=e(t.MainBtn,"Start",this.handleClickStart,!1);const i=this.getPageLayout(this.btnStart);this.rootElem.append(i),this.rootElem.append(n.elem)}getPageLayout(t){const e=document.createElement("main");e.className="start-page";const i=document.createElement("h1");return i.className="start-page__title",i.textContent="Async Race",e.append(i),e.append(t),e}}var s,r,o;!function(t){t.Started="started",t.Stopped="stopped",t.Drive="drive"}(s||(s={})),function(t){t.Id="id",t.Wins="wins",t.Time="time"}(r||(r={})),function(t){t.Asc="ASC",t.Desc="DESC"}(o||(o={}));const l="#000000",c=1e6,d=1e3;class h{constructor(t,e,i){this.car=document.createElement("div"),this.car.className="car",this.id=t,this.name=e,this.color=i,this.numberStart=0,this.isStopped=!0;const n=this.getCarControls();this.setCarTrack(),this.car.append(n,this.carTrackEl)}getCarControls(){const i=document.createElement("div");i.className="car__controls";const n=document.createElement("div");return n.className="control-panel",this.btnSelect=e(t.SelectBtn,"Select",null,!1),this.btnRemove=e(t.RemoveBtn,"Remove",null,!1),n.append(this.btnSelect,this.btnRemove),this.nameCarEl=document.createElement("h2"),this.nameCarEl.className="car__name",this.nameCarEl.textContent=this.name,i.append(n,this.nameCarEl),i}setCarTrack(){this.carTrackEl=document.createElement("div"),this.setColorForCarTrackEl();const t=this.getCarEngineBtnsBlock();this.carPictureEl=document.createElement("div"),this.carPictureEl.className="car__picture",this.changeCarPictureColor();const e=document.createElement("div");e.className="finish-flag",e.innerHTML=this.getFlagPicture(),this.carTrackEl.append(t,this.carPictureEl,e)}static isCarColorTooLight(t){if(7!==t.length)return!1;const e=255-parseInt(t.slice(1,3),16),i=255-parseInt(t.slice(3,5),16),n=255-parseInt(t.slice(5),16);return e<25&&i<25&&n<25}setColorForCarTrackEl(){h.isCarColorTooLight(this.color)?this.carTrackEl.className="car__track car__track_is_dark":this.carTrackEl.className="car__track"}getCarEngineBtnsBlock(){const i=document.createElement("div");return i.className="car__engine-btns control-panel",this.btnStartEngine=e(t.EngineStartBtn,"A",null,!1),this.btnStopEngine=e(t.EngineStopBtn,"B",null,!0),i.append(this.btnStartEngine,this.btnStopEngine),i}changeCarPictureColor(){this.setColorForCarTrackEl(),this.carPictureEl.innerHTML=h.getCarPicture(this.color)}changeNameCar(){this.nameCarEl.textContent=this.name}static getCarPicture(t){return`<svg xmlns="http://www.w3.org/2000/svg"\n              width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"\n              preserveAspectRatio="xMidYMid meet">\n              <g fill="${t}" transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)">\n              <path d="M3525 5341 c-72 -18 -79 -28 -90 -121 -4 -30 -11 -62 -16 -71 -4 -9\n              -97 -51 -206 -94 -774 -304 -1348 -540 -1603 -661 -163 -77 -222 -91 -421\n              -104 -85 -5 -170 -14 -189 -20 -101 -32 -362 -58 -620 -63 l-115 -2 -47 -80\n              c-47 -78 -47 -80 -29 -100 34 -36 35 -77 5 -177 -30 -99 -34 -178 -19 -370 5\n              -67 4 -88 -6 -88 -29 0 -83 -56 -110 -114 -50 -106 -74 -343 -48 -467 13 -58\n              13 -62 3 -159 -5 -54 16 -238 28 -244 2 -1 29 -20 61 -41 73 -49 123 -103 132\n              -143 17 -79 167 -155 355 -181 104 -15 969 -97 1087 -104 l32 -2 5 160 c7 230\n              50 394 146 559 281 479 917 673 1405 429 316 -159 530 -424 598 -742 22 -106\n              29 -365 13 -519 l-8 -82 3002 0 c2855 0 3002 1 2995 18 -33 87 -56 325 -45\n              461 28 320 177 567 459 759 399 273 847 282 1243 24 239 -157 397 -392 460\n              -687 18 -84 15 -341 -5 -430 -8 -38 -14 -71 -12 -73 7 -8 386 20 478 34 180\n              28 253 65 304 152 24 41 28 57 28 127 -1 44 -9 117 -20 163 -18 79 -18 88 -2\n              190 31 199 40 306 41 497 1 176 -1 195 -23 260 -46 135 -103 190 -283 274\n              -222 104 -633 220 -1168 330 -523 108 -1524 210 -2054 211 l-229 0 -236 139\n              c-813 477 -1593 884 -1852 966 -498 157 -1598 195 -2892 100 l-188 -14 -47 30\n              c-92 58 -223 89 -297 70z m1912 -311 c13 -45 58 -305 88 -515 33 -226 74 -539\n              71 -542 -7 -7 -1672 40 -2054 58 -357 16 -464 56 -573 215 -62 91 -87 225 -59\n              326 12 40 56 74 192 148 369 198 799 289 1618 340 246 15 290 16 510 16 l194\n              -1 13 -45z m649 10 c383 -36 717 -86 934 -139 210 -52 451 -163 720 -332 141\n              -88 379 -259 380 -271 0 -5 -14 -8 -32 -8 -48 0 -114 -37 -140 -78 -24 -39\n              -30 -113 -15 -189 l9 -43 -904 0 -904 0 -176 540 -175 540 47 0 c25 0 141 -9\n              256 -20z"/>\n              <path d="M2617 3125 c-431 -82 -774 -440 -838 -875 -17 -117 -7 -292 24 -410\n              113 -436 497 -751 947 -777 507 -29 959 313 1076 813 28 117 26 348 -4 467\n              -94 378 -383 670 -760 768 -105 27 -336 34 -445 14z m378 -310 c84 -21 209\n              -85 280 -142 116 -94 210 -242 251 -393 23 -87 24 -260 0 -355 -58 -237 -242\n              -439 -473 -519 -531 -186 -1074 277 -969 828 30 152 94 274 206 386 111 110\n              237 178 385 206 84 16 235 11 320 -11z"/>\n              <path d="M2918 2568 c2 -90 7 -167 12 -172 17 -17 108 58 201 166 l51 57 -48\n              31 c-52 33 -131 65 -185 75 l-34 6 3 -163z"/>\n              <path d="M2591 2700 c-62 -22 -167 -82 -164 -94 3 -13 237 -216 249 -216 7 0\n              15 7 18 16 8 20 8 127 -1 232 -7 95 -8 96 -102 62z"/>\n              <path d="M3209 2355 c-57 -64 -105 -123 -107 -131 -6 -25 46 -35 157 -29 58 3\n              121 8 139 11 33 5 34 6 27 42 -7 44 -64 167 -92 201 l-19 24 -105 -118z"/>\n              <path d="M2260 2409 c-31 -44 -68 -133 -77 -186 l-6 -33 155 0 c165 0 201 9\n              181 44 -13 24 -204 216 -214 216 -5 0 -22 -18 -39 -41z"/>\n              <path d="M2786 2354 c-36 -35 0 -87 44 -64 26 14 26 56 1 70 -25 13 -27 13\n              -45 -6z"/>\n              <path d="M2751 2186 c-57 -32 -68 -111 -22 -157 43 -42 101 -43 143 -1 42 42\n              41 100 -1 143 -33 32 -78 38 -120 15z"/>\n              <path d="M2560 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n              -54 2z"/>\n              <path d="M3002 2124 c-27 -19 -28 -36 -3 -58 25 -23 61 -6 61 29 0 33 -30 49\n              -58 29z"/>\n              <path d="M2245 1993 c-77 -6 -76 -5 -59 -65 16 -55 61 -146 92 -186 l18 -23\n              103 122 c57 67 104 129 105 138 1 14 -14 16 -104 17 -58 0 -127 -1 -155 -3z"/>\n              <path d="M3165 1981 c-44 -4 -61 -10 -63 -22 -3 -16 210 -229 228 -229 22 0\n              86 141 105 228 l7 32 -109 -2 c-59 -1 -135 -4 -168 -7z"/>\n              <path d="M2776 1914 c-19 -18 -19 -20 -6 -45 6 -11 21 -19 35 -19 20 0 45 24\n              45 44 0 10 -32 36 -45 36 -7 0 -21 -7 -29 -16z"/>\n              <path d="M2589 1743 c-86 -90 -139 -151 -139 -162 0 -25 179 -101 236 -101\n              l27 0 -7 143 c-9 166 -13 187 -35 187 -9 0 -46 -30 -82 -67z"/>\n              <path d="M2936 1801 c-6 -10 -24 -168 -29 -258 -3 -60 -2 -63 19 -63 79 0 262\n              68 248 92 -5 7 -53 64 -108 126 -93 105 -117 124 -130 103z"/>\n              <path d="M10723 3125 c-318 -58 -597 -266 -743 -555 -223 -441 -98 -996 289\n              -1288 112 -84 188 -125 311 -166 274 -91 545 -70 802 61 552 282 735 983 392\n              1500 -225 339 -651 521 -1051 448z m385 -315 c348 -98 579 -443 532 -796 -67\n              -508 -596 -796 -1055 -574 -239 116 -396 352 -412 620 -20 335 192 640 516\n              745 122 40 289 42 419 5z"/>\n              <path d="M11017 2568 c3 -90 9 -167 14 -172 13 -14 53 18 155 122 l95 97 -23\n              18 c-50 40 -189 97 -235 97 -10 0 -11 -33 -6 -162z"/>\n              <path d="M10705 2706 c-50 -16 -133 -58 -163 -82 l-23 -19 121 -107 c67 -60\n              128 -108 135 -108 23 0 27 39 20 186 -8 162 -4 157 -90 130z"/>\n              <path d="M11307 2354 c-59 -65 -107 -126 -107 -136 0 -11 11 -18 38 -22 44 -7\n              278 7 289 17 15 16 -51 183 -94 236 l-19 24 -107 -119z"/>\n              <path d="M10362 2413 c-39 -62 -70 -134 -78 -184 l-7 -39 152 0 c86 0 161 5\n              172 10 17 10 18 13 5 38 -8 15 -59 71 -114 125 l-99 99 -31 -49z"/>\n              <path d="M10888 2359 c-24 -14 -23 -56 2 -69 44 -23 80 29 44 64 -18 19 -23\n              19 -46 5z"/>\n              <path d="M10851 2187 c-49 -29 -66 -101 -35 -146 9 -13 32 -29 50 -37 29 -12\n              39 -12 68 0 99 41 85 180 -19 192 -24 3 -50 -1 -64 -9z"/>\n              <path d="M10660 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n              -54 2z"/>\n              <path d="M11096 2124 c-9 -8 -16 -22 -16 -29 0 -13 26 -45 36 -45 20 0 44 25\n              44 45 0 14 -8 29 -19 35 -25 13 -27 13 -45 -6z"/>\n              <path d="M10335 1991 c-60 -6 -60 -6 -57 -36 9 -69 104 -248 122 -229 57 61\n              210 250 207 258 -4 12 -176 17 -272 7z"/>\n              <path d="M11267 1983 c-68 -5 -79 -19 -47 -60 23 -31 200 -193 210 -193 3 0\n              20 24 37 53 29 48 52 111 67 180 l6 27 -107 -2 c-60 -1 -134 -3 -166 -5z"/>\n              <path d="M10870 1910 c-16 -31 4 -62 38 -58 21 2 28 9 30 32 5 45 -47 65 -68\n              26z"/>\n              <path d="M10651 1703 c-56 -59 -101 -113 -101 -120 0 -28 172 -103 237 -103\n              l26 0 -7 123 c-10 179 -15 207 -36 207 -10 0 -63 -48 -119 -107z"/>\n              <path d="M11035 1801 c-7 -12 -23 -144 -29 -243 -4 -77 -4 -78 19 -78 45 0\n              130 22 193 51 l64 29 -19 23 c-65 82 -198 227 -209 227 -7 0 -15 -4 -19 -9z"/>\n              </g>\n              </svg>`}getFlagPicture(){return'<svg data-name="Layer 1" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><title/><path d="M448.24,140.92l-.77-.77c-19.39-19.2-39.75-31.51-62.15-37.62v0l-1.8-.47h0l-2.06-.53v0c-17.63-4.21-36.52-4.7-59-1.51v0l-2.73.42h0l-1.43.21v0c-15.69,2.48-31.56,6.39-46.92,10.19-4.94,1.22-9.88,2.44-14.81,3.62h0c-20,4.76-41.36,9.16-62.57,9.16h0c-21.56,0-40.81-4.58-58.74-14l3.58-20.32A8,8,0,1,0,123,86.54L63.75,422.68A8,8,0,0,0,70.24,432a7.34,7.34,0,0,0,1.39.13,8,8,0,0,0,7.87-6.62l24.33-137.95c17.08,15.13,35,25.12,54.48,30.43v0l1.79.46h0l2.08.53v0a135,135,0,0,0,31.66,3.59,194.88,194.88,0,0,0,27.36-2.07v0l2.73-.41h0l1.42-.21v0c15.69-2.48,31.56-6.39,46.92-10.19,4.94-1.22,9.88-2.44,14.81-3.61h0c20-4.76,41.35-9.16,62.57-9.16h0c22.89,0,43.19,5.16,62.05,15.76l2.43,1.37.52-2.74c3.74-19.76,7.48-39.28,11.11-58l0-.13c3.72-19.19,7.45-38.14,11.08-56.32l0-.15c3.72-18.66,7.45-37,11.08-54.66ZM348,292.87c-20,.22-40.05,4.15-58.88,8.57,0-.1,0-.19,0-.28q5.19-31.52,10.36-62.94c16.48-3.58,37.66-7.31,58.93-6.05-.22,1.29-.45,2.59-.67,3.89l-.42,2.39q-.48,2.81-1,5.62l-.36,2.09C353.39,261.45,350.7,277.09,348,292.87Zm-161.71-111,.84-4.88c.16-.88.31-1.75.46-2.64.42-2.43.84-4.88,1.26-7.33a1.06,1.06,0,0,0,0-.19c2.22-12.88,4.47-26,6.73-39.19,20-.21,40-4.15,58.88-8.56l0,.15q-5.19,31.58-10.38,63.06c-16.49,3.58-37.66,7.31-58.93,6.05l.48-2.79C185.87,184.28,186.08,183.06,186.29,181.83Zm109.73,53h0c-8.25,1.84-16.6,3.89-24.69,5.89-11.2,2.77-22.75,5.62-34.14,7.89q5.2-31.44,10.41-63h0c8.25-1.84,16.6-3.89,24.69-5.89,11.2-2.77,22.75-5.62,34.15-7.89q-5.22,31.44-10.42,63ZM180.47,192c-.13.75-.25,1.49-.38,2.24-.28,1.58-.55,3.17-.83,4.76-.17,1-.33,1.91-.5,2.87-.29,1.69-.59,3.39-.88,5.09l-.21,1.18c-2.55,14.68-5.09,29.2-7.58,43.38-20-3.54-38.17-11.82-55.46-25.24l9.42-53.45A125.09,125.09,0,0,0,180.47,192Zm242,57.54a125.52,125.52,0,0,0-59.3-21c.11-.63.21-1.25.32-1.88q.48-2.72.94-5.41l.27-1.53c.36-2.1.73-4.21,1.09-6.3l.06-.34q1.44-8.26,2.86-16.43.54-3,1.06-6.06l0-.1c.45-2.56.89-5.11,1.34-7.65.05-.3.1-.6.16-.9l1.23-7,.08-.43c.32-1.83.64-3.64.95-5.45,21.41,3.8,40.81,13.05,59.22,28.24C429.37,214.13,425.91,231.71,422.45,249.52ZM380.73,105.46q-1.17,6.5-2.34,13.12l-.08.43q-2.06,11.51-4.13,23.29c-.05.24-.09.49-.13.74q-1.87,10.58-3.76,21.3h0v0c-17.22-2.51-36.09-1.73-59,2.43q1.9-11.47,3.8-22.93l1.38-8.27c.39-2.37.78-4.73,1.18-7.1q2-12.18,4.05-24.34C344.37,100.82,363.21,101.24,380.73,105.46ZM162.89,315q1.19-6.6,2.38-13.3l0-.27c2.65-14.86,5.34-30,8-45.34h.13c2,.3,4.08.54,6.16.75l.42,0c4.45.42,9,.65,13.74.65a215.59,215.59,0,0,0,38.51-3.87q-.93,5.56-1.85,11.13-4.27,25.82-8.56,51.52C199.25,319.65,180.41,319.23,162.89,315Z"/></svg>'}setAnimation(t){var e;this.animation=null===(e=this.carPictureEl)||void 0===e?void 0:e.animate([{transform:"translateX(0)"},{transform:`translateX(${t})`}],{duration:this.time,fill:"forwards"})}static getAnimationEndPos(t){var e;const i=document.body.offsetWidth,n=null===(e=t.carPictureEl)||void 0===e?void 0:e.getBoundingClientRect(),a=null==n?void 0:n.left;return i-(null==n?void 0:n.width)-a-10+"px"}setCarTime(t){this.time=t}setIsStopped(t){this.isStopped=t}setNumberStart(t){this.numberStart=t}}const m=new class{constructor(){this.handleClickGarage=()=>{this.btnGarage.disabled=!0,this.btnWinners.disabled=!1;const t=new Event("show-garage-page",{bubbles:!0});this.btnGarage.dispatchEvent(t)},this.handleClickWinners=()=>{this.btnGarage.disabled=!1,this.btnWinners.disabled=!0;const t=new Event("show-winners-page",{bubbles:!0});this.btnWinners.dispatchEvent(t)},this.header=document.createElement("header"),this.header.className="header";const i=document.createElement("nav");i.className="control-panel",this.btnGarage=e(t.MainBtn,"To garage",this.handleClickGarage,!0),this.btnWinners=e(t.MainBtn,"To winners",this.handleClickWinners,!1),i.append(this.btnGarage,this.btnWinners),this.header.append(i)}},u=["Audi","Alfa Romeo","Alpina","Aston Martin","Axon","Ford","Ferrari","Fiat","GAZ","GMC","Honda","Hummer","Hyundai","Infiniti","Isuzu","JAC","Jaguar","Jeep","Kamaz","Lada","Lexus","Lotus","MAN","Maybach","MAZ","Mazda","McLaren","Nissan","Opel","Paccar","Pagani","Pontiac","Porsche","Renault","Škoda","Smart","Subaru","Suzuki","Tesla","Toyota","UAZ","Volvo","ZAZ","XPeng","TVR","Saab","RAM","Chevrolet","Mazzanti","Daewoo"],g=["Roadster","S","X","3","Y","Cybertruck","X5","X7","X3","X6","GT4","FXX","599 GTO","Enzo","458 Italia","250 GTO","Priora","4x4","Rio","Focus","Kalina","Vesta","Spark","Lacetti","Nexia","Matiz","Cobalt","Captiva","A7","A5","A3","A8","TT","Corolla","Camry","RAV4","Impreza","WRX","ES","LS","RX","GX","LX","GS","LC500","Gallardo","Aventador","911","Cayenne","FX37"];var v=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function o(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,o)}l((n=n.apply(t,e||[])).next())}))};const p="http://127.0.0.1:3000",C=`${p}/garage`,b=`${p}/engine`,E=`${p}/winners`,P=(t,e)=>v(void 0,void 0,void 0,(function*(){const i=yield fetch(`${C}?_page=${t}&_limit=${e}`);return{total:+i.headers.get("X-Total-Count"),cars:yield i.json()}})),N=(t,e)=>v(void 0,void 0,void 0,(function*(){const i={name:t,color:e},n=yield fetch(`${C}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return yield n.json()}));function f(t,e){const i=Math.ceil(t),n=Math.floor(e);return Math.floor(Math.random()*(n-i+1))+i}function S(){const t=f(0,u.length-1),e=f(0,g.length-1);return`${u[t]} ${g[e]}`}const y=(t,e)=>v(void 0,void 0,void 0,(function*(){const i=yield fetch(`${b}?id=${t}&status=${e}`,{method:"PATCH"});return yield i.json()})),w=t=>v(void 0,void 0,void 0,(function*(){const e=yield fetch(`${b}?id=${t}&status=drive`,{method:"PATCH"});return yield e.json()})),_=(t,e,i,n)=>v(void 0,void 0,void 0,(function*(){const a=yield fetch(`${E}?_page=${t}&_limit=${e}&_sort=${i}&_order=${n}`);return{total:+a.headers.get("X-Total-Count"),winners:yield a.json()}}));var T;!function(t){t.IsHidden="notification_is_hidden",t.IsShown="notification_is_shown"}(T||(T={}));class M{constructor(){this.hideNotification=()=>{this.elem.classList.add(T.IsHidden)},this.elem=document.createElement("div"),this.elem.className=`notification ${T.IsHidden}`}showNotification(){this.elem.classList.remove(T.IsHidden),this.elem.classList.add(T.IsShown)}closeNotification(){this.elem.addEventListener("transitionend",this.hideNotification),this.elem.classList.remove(T.IsShown)}changeMessage(t){this.elem.textContent=t}}var k=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function o(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,o)}l((n=n.apply(t,e||[])).next())}))};class x{constructor(t){this.getDataList=()=>{const t=document.createElement("datalist");t.id="data-list-cars";for(let e=0;e<u.length;e+=1)for(let i=0;i<g.length;i+=1){const n=document.createElement("option");n.value=`${u[e]} ${g[i]}`,t.append(n)}return t},this.handleClickCreateCar=()=>{this.handleClickCreateCarPromise().catch((t=>{console.log(t)}))},this.handleClickCreateCarPromise=()=>k(this,void 0,void 0,(function*(){var t,e,i,n,a,s;try{const r=(null===(t=this.setCreateCar)||void 0===t?void 0:t.inputName).value,o=(null===(e=this.setCreateCar)||void 0===e?void 0:e.inputColor).value,c=yield N(r,o);if(this.totalCars+=1,this.updateTotalCarsElem(),this.arrCars.length<7){const t=new h(c.id,c.name,c.color);null===(i=this.arrCars)||void 0===i||i.push(t),null===(n=this.carsContainer)||void 0===n||n.append(t.car)}else this.btnNext.disabled=!1;(null===(a=this.setCreateCar)||void 0===a?void 0:a.inputName).value="",(null===(s=this.setCreateCar)||void 0===s?void 0:s.inputColor).value=l,this.setCreateCar.btn.disabled=!0}catch(t){console.log("error")}})),this.handleInputNameCreate=()=>{var t,e;const i=null===(t=this.setCreateCar)||void 0===t?void 0:t.btn;""!==(null===(e=this.setCreateCar)||void 0===e?void 0:e.inputName).value?i.disabled=!1:i.disabled=!0},this.handleClickUpdateCar=()=>{this.handleClickUpdateCarPromise().catch((t=>{console.log(t)}))},this.handleClickUpdateCarPromise=()=>k(this,void 0,void 0,(function*(){var t,e,i,n,a;try{const s=null===(t=this.setUpdateCar)||void 0===t?void 0:t.inputName,r=null===(e=this.setUpdateCar)||void 0===e?void 0:e.inputColor,o=this.getChoosenCarById(this.selectCar);if(o&&o.name===s.value&&o.color===r.value)return void this.resetSelectedCar();const l=yield(i=this.selectCar,n=s.value,a=r.value,v(void 0,void 0,void 0,(function*(){const t={name:n,color:a},e=yield fetch(`${C}/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return yield e.json()})));o&&(o.name=l.name,o.color=l.color,o.changeCarPictureColor(),o.changeNameCar()),this.resetSelectedCar()}catch(t){console.log("error")}})),this.handleInputNameUpdate=()=>{var t,e;const i=null===(t=this.setUpdateCar)||void 0===t?void 0:t.btn;""!==(null===(e=this.setUpdateCar)||void 0===e?void 0:e.inputName).value?i.disabled=!1:i.disabled=!0},this.handleRace=()=>{var t,e,i,n,a;const s=h.getAnimationEndPos(this.arrCars[0]);this.isReset=!1,this.numberRace+=1,this.numberRace>c&&(this.numberRace=0),(null===(t=this.settingsBtns)||void 0===t?void 0:t.btnRace).disabled=!0,(null===(e=this.settingsBtns)||void 0===e?void 0:e.btnReset).disabled=!1,(null===(i=this.settingsBtns)||void 0===i?void 0:i.btnGenerate).disabled=!0,(null===(n=this.setCreateCar)||void 0===n?void 0:n.inputName).disabled=!0,this.btnNext.disabled=!0,this.btnPrev.disabled=!0,null===(a=this.arrCars)||void 0===a||a.forEach((t=>{t.btnSelect.disabled=!0,t.btnRemove.disabled=!0,t.btnStartEngine.disabled=!0,this.startRace(t,this.numberRace,s).catch((t=>{console.log(t)}))}))},this.startRace=(t,e,i)=>k(this,void 0,void 0,(function*(){let n;try{if(this.isReset||e!==this.numberRace)return;n=yield y(t.id,s.Started)}catch(t){return}if(!this.isReset&&e===this.numberRace){t.setCarTime(n.distance/n.velocity),t.setAnimation(i),t.animation.play();try{let i;if(this.isReset||e!==this.numberRace)return;if(i=yield w(t.id),void 0===this.carWinner&&i.success&&!this.isReset&&e===this.numberRace){this.carWinner=t.id;const e=`${t.name} went first [${(t.time/1e3).toFixed(2)}s]`;this.notification.changeMessage(e),this.notification.showNotification(),this.addWinnerToDB(t).catch((t=>{console.log(t)}))}}catch(i){this.isReset||e!==this.numberRace||(console.log("Engine of",t.name,"broke down"),t.animation.pause())}}})),this.addWinnerToDB=t=>k(this,void 0,void 0,(function*(){let e;try{e=yield(i=t.id,v(void 0,void 0,void 0,(function*(){const t=yield fetch(`${E}/${i}`);return yield t.json()})))}catch(t){}var i;if(void 0===e||Object.keys(e).length){if(void 0!==e)try{const i=e.wins+1,n=t.time/d<e.time?t.time/d:e.time;yield((t,e,i)=>v(void 0,void 0,void 0,(function*(){const n={wins:e,time:i},a=yield fetch(`${E}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return yield a.json()})))(t.id,i,n)}catch(t){console.log("error")}}else try{yield((t,e,i)=>v(void 0,void 0,void 0,(function*(){const e={id:t,wins:1,time:i},n=yield fetch(`${E}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return yield n.json()})))(t.id,0,t.time/d)}catch(t){console.log("error")}})),this.handleReset=()=>{this.handleResetPromise().catch((t=>{console.log(t)}))},this.handleResetPromise=()=>k(this,void 0,void 0,(function*(){var t,e,i,n,a,r,o;(null===(t=this.settingsBtns)||void 0===t?void 0:t.btnReset).disabled=!0,this.isReset=!0;try{const t=null===(e=this.arrCars)||void 0===e?void 0:e.map((t=>y(t.id,s.Stopped)));yield Promise.all(t),null===(i=this.arrCars)||void 0===i||i.forEach((t=>{var e;null===(e=t.animation)||void 0===e||e.cancel()}))}catch(t){console.log("error")}void 0!==this.carWinner&&(this.carWinner=void 0,this.notification.closeNotification()),(null===(n=this.settingsBtns)||void 0===n?void 0:n.btnRace).disabled=!1,(null===(a=this.settingsBtns)||void 0===a?void 0:a.btnGenerate).disabled=!1,(null===(r=this.setCreateCar)||void 0===r?void 0:r.inputName).disabled=!1,1!==this.curPageNumber&&(this.btnPrev.disabled=!1),this.isOnLastPageNow()||(this.btnNext.disabled=!1),null===(o=this.arrCars)||void 0===o||o.forEach((t=>{t.btnSelect.disabled=!1,t.btnRemove.disabled=!1,t.btnStartEngine.disabled=!1}))})),this.handleGenerateCars=()=>{this.handleGenerateCarsPromise().catch((t=>{console.log(t)}))},this.handleGenerateCarsPromise=()=>k(this,void 0,void 0,(function*(){try{yield v(void 0,void 0,void 0,(function*(){const t=[];for(let e=0;e<100;e+=1){const e=S(),i=`#${f(0,255).toString(16).padStart(2,"0")}${f(0,255).toString(16).padStart(2,"0")}${f(0,255).toString(16).padStart(2,"0")}`;t.push(N(e,i))}yield Promise.all(t)})),this.totalCars+=100,this.updateTotalCarsElem(),this.btnNext.disabled=!1,this.arrCars.length<7&&this.updateCarsOnCurPage().catch((t=>{console.log(t)}))}catch(t){console.log("error")}})),this.updateCarsOnCurPage=()=>k(this,void 0,void 0,(function*(){var t,e,i,n;try{const{cars:a}=yield P(this.curPageNumber,7),{length:s}=this.arrCars;for(let i=s;i<a.length;i+=1){const n=new h(a[i].id,a[i].name,a[i].color);null===(t=this.arrCars)||void 0===t||t.push(n),null===(e=this.carsContainer)||void 0===e||e.append(n.car)}this.arrCars.length?(null===(n=this.settingsBtns)||void 0===n?void 0:n.btnRace).disabled=!1:(null===(i=this.settingsBtns)||void 0===i?void 0:i.btnRace).disabled=!0}catch(t){console.log("error",t)}})),this.handlePrevClick=()=>{this.curPageNumber-=1,this.updateNumberPage(),1===this.curPageNumber?this.btnPrev.disabled=!0:this.btnPrev.disabled=!1,this.isOnLastPageNow()?this.btnNext.disabled=!0:this.btnNext.disabled=!1,this.showPrevNextPage().catch((t=>{console.log(t)}))},this.handleNextClick=()=>{this.curPageNumber+=1,this.updateNumberPage(),this.isOnLastPageNow()?this.btnNext.disabled=!0:this.btnNext.disabled=!1,this.btnPrev.disabled=!1,this.showPrevNextPage().catch((t=>{console.log(t)}))},this.isOnLastPageNow=()=>this.curPageNumber===Math.ceil(this.totalCars/7),this.showPrevNextPage=()=>k(this,void 0,void 0,(function*(){var t,e;(null===(t=this.settingsBtns)||void 0===t?void 0:t.btnRace).disabled=!1;try{const{cars:t}=yield P(this.curPageNumber,7);this.carsContainer.innerHTML="",this.arrCars=t.map((t=>new h(t.id,t.name,t.color))),this.arrCars.forEach((t=>{var e;null===(e=this.carsContainer)||void 0===e||e.append(t.car)}))}catch(t){console.log("error")}(null===(e=this.settingsBtns)||void 0===e?void 0:e.btnRace).disabled=!1})),this.handleClickCarsContainer=t=>{var e;const i=t.target,n=i.closest(".btn-select"),a=i.closest(".btn-remove"),s=i.closest(".btn-start"),r=i.closest(".btn-stop"),o=i.closest(".car");if(!(n||a||s||r))return;let l=this.arrCars[0],c=0;null===(e=this.arrCars)||void 0===e||e.forEach(((t,e)=>{t.car===o&&(l=t,c=e)})),n?this.handleSelectCar(l):a?this.handleRemoveCar(l,c).catch((t=>{console.log(t)})):s?this.handleStartCar(l,l.numberStart).catch((t=>{console.log(t)})):this.handleStopCar(l).catch((t=>{console.log(t)}))},this.handleRemoveCar=(t,e)=>k(this,void 0,void 0,(function*(){var i,n;try{this.selectCar===t.id&&this.resetSelectedCar(),yield(n=t.id,v(void 0,void 0,void 0,(function*(){const t=yield fetch(`${E}/${n}`,{method:"DELETE"});yield t.json()})))}catch(t){console.log("error")}try{yield(t=>v(void 0,void 0,void 0,(function*(){const e=yield fetch(`${C}/${t}`,{method:"DELETE"});yield e.json()})))(t.id)}catch(t){console.log("error")}this.arrCars=null===(i=this.arrCars)||void 0===i?void 0:i.slice(0,e).concat(this.arrCars.slice(e+1)),t.car.remove(),this.totalCars-=1,this.updateTotalCarsElem(),this.isOnLastPageNow()&&(this.btnNext.disabled=!0),yield this.updateCarsOnCurPage()})),this.resetSelectedCar=()=>{var t,e,i;const n=null===(t=this.setUpdateCar)||void 0===t?void 0:t.inputName,a=null===(e=this.setUpdateCar)||void 0===e?void 0:e.inputColor;n.value="",a.value=l,n.disabled=!0,a.disabled=!0,(null===(i=this.setUpdateCar)||void 0===i?void 0:i.btn).disabled=!0,this.selectCar=-1},this.handleStartCar=(t,e)=>k(this,void 0,void 0,(function*(){var i;let n;const a=h.getAnimationEndPos(t);t.setIsStopped(!1),(null===(i=this.settingsBtns)||void 0===i?void 0:i.btnRace).disabled=!0,t.btnRemove.disabled=!0;try{t.btnStartEngine.disabled=!0,n=yield y(t.id,s.Started)}catch(t){return}t.setCarTime(n.distance/n.velocity),t.setAnimation(a),t.animation.play(),t.btnStopEngine.disabled=!1;try{yield w(t.id)}catch(i){t.numberStart===e&&(console.log("Engine of",t.name,"broke down"),t.animation.pause())}})),this.handleStopCar=t=>k(this,void 0,void 0,(function*(){var e;t.btnStopEngine.disabled=!0,t.setIsStopped(!0),t.setNumberStart(t.numberStart+1),t.numberStart>c&&t.setNumberStart(0);try{yield y(t.id,s.Stopped),t.animation.cancel()}catch(t){console.log("error")}t.btnStartEngine.disabled=!1,t.btnRemove.disabled=!1,this.areAllCarsStopped()&&((null===(e=this.settingsBtns)||void 0===e?void 0:e.btnRace).disabled=!1)})),this.areAllCarsStopped=()=>this.arrCars.every((t=>!t.btnStartEngine.disabled)),this.rootElem=t,this.curPageNumber=1,this.selectCar=-1,this.notification=new M,this.isReset=!0,this.numberRace=0}initPage(){return k(this,void 0,void 0,(function*(){try{const t=yield P(1,7);this.generatePage(t)}catch(t){t instanceof TypeError&&"Failed to fetch"===t.message&&n.showServerNotification()}}))}generatePage(t){this.rootPageElem=document.createElement("main"),this.rootPageElem.className="garage-page garage-page_margin_top";const e=this.getSettingsBlock(),i=this.getSectionCars(t);this.rootPageElem.append(e,i),this.showPage()}getSettingsBlock(){const t=document.createElement("div");t.className="settings";const e=this.getSetCreateCar(),i=this.getDataList();e.append(i);const n=this.getSetUpdateCar(),a=this.getSetControls();return t.append(e,n,a),t}getSetCreateCar(){const t=document.createElement("div");return t.className="settings__create-car control-panel",this.setCreateCar=this.fillSetCar(t,"Create",this.handleClickCreateCar,this.handleInputNameCreate),t}updateTotalCarsElem(){var t;this.totalCarsElem.textContent=null===(t=this.totalCars)||void 0===t?void 0:t.toString()}fillSetCar(i,n,a,s){const r=document.createElement("input");r.className="input-car-name",r.type="text",r.name="car-name",r.setAttribute("list","data-list-cars"),r.addEventListener("input",s);const o=document.createElement("input");o.className="input-color",o.type="color",o.name="car-color",o.value=l;const c=e(t.Btn,n,a,!0);return i.append(r,o,c),{inputName:r,inputColor:o,btn:c}}getSetUpdateCar(){const t=document.createElement("div");return t.className="settings__update-car control-panel",this.setUpdateCar=this.fillSetCar(t,"Update",this.handleClickUpdateCar,this.handleInputNameUpdate),this.setUpdateCar.inputName.disabled=!0,this.setUpdateCar.inputColor.disabled=!0,t}getChoosenCarById(t){var e;const i=null===(e=this.arrCars)||void 0===e?void 0:e.filter((e=>e.id===t));if(i.length>0)return i[0]}getSetControls(){const i=document.createElement("div");i.className="settings__controls control-panel";const n=e(t.MainBtn,"Race",this.handleRace,!1),a=e(t.MainBtn,"Reset",this.handleReset,!0),s=e(t.Btn,"Generate cars",this.handleGenerateCars,!1);return i.append(n,a,s),this.settingsBtns={btnRace:n,btnReset:a,btnGenerate:s},i}getSectionCars(t){const e=document.createElement("section");e.className="garage-page__cars";const i=document.createElement("h1");i.className="title",this.totalCarsElem=document.createElement("span"),this.totalCars=t.total,this.totalCarsElem.textContent=this.totalCars.toString(),i.append("Garage (",this.totalCarsElem,")");const n=document.createElement("div");n.className="subtitle",this.curPageNumberElem=document.createElement("span"),this.curPageNumberElem.textContent=this.curPageNumber.toString(),n.append("Page #",this.curPageNumberElem),this.fillCarsContainer(t);const a=this.getPagination();return e.append(i,n,this.carsContainer,a),e}fillCarsContainer(t){this.carsContainer=document.createElement("div"),this.carsContainer.className="garage-page__cars-container",this.carsContainer.addEventListener("click",this.handleClickCarsContainer),this.arrCars=t.cars.map((t=>new h(t.id,t.name,t.color))),this.arrCars.forEach((t=>{this.carsContainer.append(t.car)}))}getPagination(){const i=document.createElement("div");i.className="control-panel",this.btnPrev=e(t.Btn,"Prev",this.handlePrevClick,!0);let n=!0;return this.totalCars>7&&(n=!1),this.btnNext=e(t.Btn,"Next",this.handleNextClick,n),i.append(this.btnPrev,this.btnNext),i}updateNumberPage(){this.curPageNumberElem.textContent=this.curPageNumber.toString()}showPage(){this.rootElem.textContent="",this.rootElem.append(m.header,this.rootPageElem,this.notification.elem)}handleSelectCar(t){var e,i,n;const a=null===(e=this.setUpdateCar)||void 0===e?void 0:e.inputName,s=null===(i=this.setUpdateCar)||void 0===i?void 0:i.inputColor;this.selectCar=t.id,a.value=t.name,s.value=t.color,a.disabled=!1,s.disabled=!1,(null===(n=this.setUpdateCar)||void 0===n?void 0:n.btn).disabled=!1}}var R=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function o(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,o)}l((n=n.apply(t,e||[])).next())}))};class L{constructor(t){this.handleClickTrHead=t=>{const e=t.target,i=e.closest(".header-tr-wins"),n=e.closest(".header-tr-time");if(i||n){if(i)switch(this.typeSort){case r.Id:this.typeSort=r.Wins,this.orderSort=o.Asc,this.trWinsElem.className="header-tr-wins header-tr-wins_is_sort-asc";break;case r.Wins:this.orderSort===o.Asc?(this.orderSort=o.Desc,this.trWinsElem.className="header-tr-wins header-tr-wins_is_sort-desc"):(this.orderSort=o.Asc,this.trWinsElem.className="header-tr-wins header-tr-wins_is_sort-asc");break;case r.Time:this.trTimeElem.className="header-tr-time",this.trWinsElem.className="header-tr-wins header-tr-wins_is_sort-asc",this.typeSort=r.Wins,this.orderSort=o.Asc}else switch(this.typeSort){case r.Id:this.typeSort=r.Time,this.orderSort=o.Asc,this.trTimeElem.className="header-tr-time header-tr-time_is_sort-asc";break;case r.Wins:this.trWinsElem.className="header-tr-wins",this.trTimeElem.className="header-tr-time header-tr-time_is_sort-asc",this.typeSort=r.Time,this.orderSort=o.Asc;break;case r.Time:this.orderSort===o.Asc?(this.orderSort=o.Desc,this.trTimeElem.className="header-tr-time header-tr-time_is_sort-desc"):(this.orderSort=o.Asc,this.trTimeElem.className="header-tr-time header-tr-time_is_sort-asc")}this.fillWinners().catch((t=>{console.log(t)}))}else this.typeSort!==r.Id&&(this.typeSort=r.Id,this.orderSort=o.Asc,this.trWinsElem.className="header-tr-wins",this.trTimeElem.className="header-tr-time",this.fillWinners().catch((t=>{console.log(t)})))},this.handleClickPrev=()=>{this.curPageNumber-=1,this.handleClickPrevNext()},this.handleClickNext=()=>{this.curPageNumber+=1,this.handleClickPrevNext()},this.handleClickPrevNext=()=>{this.updateNumberPage(),this.updatePaginationButtons(),this.fillWinners().catch((t=>{console.log(t)}))},this.showPage=()=>R(this,void 0,void 0,(function*(){this.rootElem.textContent="",this.rootElem.append(m.header,this.rootPageElem),yield this.fillWinners()})),this.fillWinners=()=>R(this,void 0,void 0,(function*(){var t;this.tbody.innerHTML="",this.isCurPageNoLongerExists()&&(this.curPageNumber=1,this.updateNumberPage());try{const e=yield _(this.curPageNumber,10,this.typeSort,this.orderSort);this.totalWin=e.total,this.updateTotalWinElem();const i=yield Promise.all(e.winners.map((t=>{return e=t.id,v(void 0,void 0,void 0,(function*(){const t=yield fetch(`${C}/${e}`);return yield t.json()}));var e}))),n=10*(this.curPageNumber-1)+1,a=e.winners.length;for(let s=0;s<a;s+=1){const a=document.createElement("tr");let r="";h.isCarColorTooLight(i[s].color)&&(r=" winner__car_is_dark"),a.className="winner",a.innerHTML=`<td class="winner__number">${n+s}</td>\n          <td class="winner__car${r}">${h.getCarPicture(i[s].color)}</td>\n          <td class="winner__name">${i[s].name}</td>\n          <td class="winner__wins">${e.winners[s].wins}</td>\n          <td class="winner__time">${e.winners[s].time.toFixed(2)}</td>`,null===(t=this.tbody)||void 0===t||t.append(a)}}catch(t){console.log("error")}this.updatePaginationButtons()})),this.isOnLastPageNow=()=>this.curPageNumber===Math.ceil(this.totalWin/10),this.isCurPageNoLongerExists=()=>this.curPageNumber>Math.ceil(this.totalWin/10),this.rootElem=t,this.curPageNumber=1,this.typeSort=r.Id,this.orderSort=o.Asc,this.initPage()}initPage(){this.generatePage()}generatePage(){this.rootPageElem=document.createElement("main"),this.rootPageElem.className="winners-page winners-page_margin_top";const t=this.getTitle(),e=this.getSubtitle(),i=this.getTableSkeleton(),n=this.getPagination();this.rootPageElem.append(t,e,i,n)}getTitle(){var t;const e=document.createElement("h1");return e.className="title",this.totalWinElem=document.createElement("span"),this.totalWinElem.textContent=null===(t=this.totalWin)||void 0===t?void 0:t.toString(),e.append("Winners (",this.totalWinElem,")"),e}getSubtitle(){const t=document.createElement("div");return t.className="subtitle",this.curPageNumberElem=document.createElement("span"),this.curPageNumberElem.textContent=this.curPageNumber.toString(),t.append("Page #",this.curPageNumberElem),t}getTableSkeleton(){const t=document.createElement("table");t.className="winners-page__table winners",this.tbody=document.createElement("tbody");const e=document.createElement("thead"),i=document.createElement("tr");return i.className="winners__header-tr header-tr",i.innerHTML="<th>Number</th>\n          <th>Car</th>\n          <th>Name</th>",this.trWinsElem=document.createElement("th"),this.trWinsElem.className="header-tr-wins",this.trWinsElem.textContent="Wins",this.trTimeElem=document.createElement("th"),this.trTimeElem.className="header-tr-time",this.trTimeElem.textContent="Best time (seconds)",i.append(this.trWinsElem,this.trTimeElem),i.addEventListener("click",this.handleClickTrHead),e.append(i),t.append(this.tbody,e),t}getPagination(){const i=document.createElement("div");return i.className="control-panel",this.btnPrev=e(t.Btn,"Prev",this.handleClickPrev,!0),this.btnNext=e(t.Btn,"Next",this.handleClickNext,!0),i.append(this.btnPrev,this.btnNext),i}updatePaginationButtons(){1===this.curPageNumber?this.btnPrev.disabled=!0:this.btnPrev.disabled=!1,this.isOnLastPageNow()?this.btnNext.disabled=!0:this.btnNext.disabled=!1}updateNumberPage(){this.curPageNumberElem.textContent=this.curPageNumber.toString()}updateTotalWinElem(){var t;this.totalWinElem.textContent=null===(t=this.totalWin)||void 0===t?void 0:t.toString()}}(new class{constructor(){this.initGaragePage=()=>{this.garagePage.initPage().catch((t=>{console.log(t)}))},this.showGaragePage=()=>{this.garagePage.showPage()},this.showWinnersPage=()=>{this.winnersPage.showPage().catch((t=>{console.log(t)}))},this.rootElem=document.createElement("div"),this.rootElem.className="app",document.body.prepend(this.rootElem),this.addListenersToDocument()}start(){this.startPage=new a(this.rootElem),this.startPage.showPage(),this.garagePage=new x(this.rootElem),this.winnersPage=new L(this.rootElem)}addListenersToDocument(){document.addEventListener("init-garage-page",this.initGaragePage),document.addEventListener("show-garage-page",this.showGaragePage),document.addEventListener("show-winners-page",this.showWinnersPage)}}).start()})();
//# sourceMappingURL=main.js.map